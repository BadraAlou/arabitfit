{% extends 'base.html' %}

{% block titre %}Ressources Humaines - Admin Biodetox Mali{% endblock %}

{% block contenu %}
<div class="admin-hr-page">
    <!-- En-tête moderne -->
    <div class="page-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <div class="header-content">
                        <h1 class="page-title">
                            <i class="bi bi-people me-3"></i>Ressources Humaines
                        </h1>
                        <p class="page-subtitle">Gestion complète des employés, présences et congés</p>
                    </div>
                </div>
                <div class="col-lg-4 text-end">
                    <div class="header-actions">
                        <a href="{% url 'boutique:admin_dashboard' %}" class="btn btn-outline-light me-2">
                            <i class="bi bi-arrow-left me-2"></i>Retour au tableau de bord
                        </a>
                        <a href="{% url 'admin:boutique_employe_add' %}" class="btn btn-light">
                            <i class="bi bi-person-plus me-2"></i>Nouvel employé
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid py-4">
        <!-- Statistiques RH modernes -->
        <div class="row g-4 mb-5">
            <div class="col-lg-3 col-md-6">
                <div class="hr-stat-card stat-employees">
                    <div class="stat-icon">
                        <i class="bi bi-people"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" data-count="{{ stats.total_employes }}">0</div>
                        <div class="stat-label">Employés Actifs</div>
                        <div class="stat-trend">
                            <i class="bi bi-arrow-up"></i>
                            <span>+2 ce mois</span>
                        </div>
                    </div>
                    <div class="stat-chart">
                        <div class="mini-chart" data-percentage="85"></div>
                    </div>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="hr-stat-card stat-attendance">
                    <div class="stat-icon">
                        <i class="bi bi-person-check"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" data-count="{{ stats.presences_aujourd_hui }}">0</div>
                        <div class="stat-label">Présents Aujourd'hui</div>
                        <div class="stat-trend">
                            <i class="bi bi-check-circle"></i>
                            <span>{{ stats.presences_aujourd_hui }}/{{ stats.total_employes }}</span>
                        </div>
                    </div>
                    <div class="stat-chart">
                        <div class="mini-chart" data-percentage="92"></div>
                    </div>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="hr-stat-card stat-leaves">
                    <div class="stat-icon">
                        <i class="bi bi-clock"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" data-count="{{ stats.conges_en_attente }}">0</div>
                        <div class="stat-label">Congés en Attente</div>
                        <div class="stat-trend">
                            <i class="bi bi-exclamation-triangle"></i>
                            <span>À traiter</span>
                        </div>
                    </div>
                    <div class="stat-chart">
                        <div class="mini-chart" data-percentage="45"></div>
                    </div>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="hr-stat-card stat-on-leave">
                    <div class="stat-icon">
                        <i class="bi bi-calendar-x"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" data-count="{{ stats.employes_en_conge }}">0</div>
                        <div class="stat-label">En Congé</div>
                        <div class="stat-trend">
                            <i class="bi bi-calendar"></i>
                            <span>Actuellement</span>
                        </div>
                    </div>
                    <div class="stat-chart">
                        <div class="mini-chart" data-percentage="15"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <!-- Demandes de congé -->
            <div class="col-lg-6">
                <div class="hr-card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title">
                                <i class="bi bi-calendar-check me-2"></i>Demandes de Congé
                            </h5>
                            <div class="card-actions">
                                <span class="badge bg-warning">{{ stats.conges_en_attente }} en attente</span>
                                <a href="{% url 'admin:boutique_conge_changelist' %}" class="btn btn-outline-primary btn-sm ms-2">
                                    <i class="bi bi-eye me-1"></i>Voir tout
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        {% for conge in conges_en_attente %}
                        <div class="leave-request-item">
                            <div class="employee-info">
                                <div class="employee-avatar">
                                    {% if conge.employe.photo %}
                                        <img src="{{ conge.employe.photo.url }}" alt="{{ conge.employe.user.get_full_name }}">
                                    {% else %}
                                        <div class="avatar-placeholder">
                                            <i class="bi bi-person"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="employee-details">
                                    <div class="employee-name">{{ conge.employe.user.get_full_name }}</div>
                                    <div class="employee-position">{{ conge.employe.get_poste_display }}</div>
                                </div>
                            </div>

                            <div class="leave-details">
                                <div class="leave-type">
                                    <span class="type-badge type-{{ conge.type_conge }}">
                                        {{ conge.get_type_conge_display }}
                                    </span>
                                </div>
                                <div class="leave-period">
                                    <i class="bi bi-calendar-range me-1"></i>
                                    {{ conge.date_debut|date:"d/m" }} - {{ conge.date_fin|date:"d/m" }}
                                    <span class="duration">({{ conge.nombre_jours }} jour{{ conge.nombre_jours|pluralize }})</span>
                                </div>
                                <div class="leave-reason">
                                    <i class="bi bi-chat-text me-1"></i>
                                    {{ conge.motif|truncatewords:8 }}
                                </div>
                            </div>

                            <div class="leave-actions">
                                <a href="{% url 'boutique:admin_approuver_conge' conge.id %}"
                                   class="btn btn-success btn-sm">
                                    <i class="bi bi-check-circle me-1"></i>Traiter
                                </a>
                            </div>
                        </div>
                        {% empty %}
                        <div class="empty-state">
                            <i class="bi bi-check-circle"></i>
                            <p>Aucune demande en attente</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Présences d'aujourd'hui -->
            <div class="col-lg-6">
                <div class="hr-card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title">
                                <i class="bi bi-person-check me-2"></i>Présences Aujourd'hui
                            </h5>
                            <div class="card-actions">
                                <span class="badge bg-success">{{ stats.presences_aujourd_hui }}  présent{{ stats.presences_aujourd_hui|pluralize }}</span>
                                <a href="{% url 'admin:boutique_presence_changelist' %}" class="btn btn-outline-success btn-sm ms-2">
                                    <i class="bi bi-eye me-1"></i>Voir tout
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        {% for presence in presences_aujourd_hui %}
                        <div class="attendance-item">
                            <div class="employee-info">
                                <div class="employee-avatar">
                                    {% if presence.employe.photo %}
                                        <img src="{{ presence.employe.photo.url }}" alt="{{ presence.employe.user.get_full_name }}">
                                    {% else %}
                                        <div class="avatar-placeholder">
                                            <i class="bi bi-person"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="employee-details">
                                    <div class="employee-name">{{ presence.employe.user.get_full_name }}</div>
                                    <div class="employee-position">{{ presence.employe.get_poste_display }}</div>
                                </div>
                            </div>

                            <div class="attendance-details">
                                <div class="time-info">
                                    <div class="arrival-time">
                                        <i class="bi bi-clock me-1"></i>
                                        Arrivée: <strong>{{ presence.heure_arrivee|time:"H:i" }}</strong>
                                    </div>
                                    {% if presence.heure_depart %}
                                        <div class="departure-time">
                                            <i class="bi bi-clock-history me-1"></i>
                                            Départ: <strong>{{ presence.heure_depart|time:"H:i" }}</strong>
                                        </div>
                                    {% else %}
                                        <div class="status-working">
                                            <i class="bi bi-circle-fill text-success me-1"></i>
                                            <span class="text-success">En cours</span>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="attendance-summary">
                                {% if presence.heures_travaillees %}
                                    <div class="hours-worked">
                                        <span class="hours-badge">{{ presence.heures_travaillees }}h</span>
                                    </div>
                                {% else %}
                                    <div class="status-indicator">
                                        <div class="pulse-dot"></div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        {% empty %}
                        <div class="empty-state">
                            <i class="bi bi-person-x"></i>
                            <p>Aucune présence enregistrée</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Liste des employés -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="hr-card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title">
                                <i class="bi bi-people me-2"></i>Liste des Employés
                            </h5>
                            <div class="card-actions">
                                <div class="btn-group">
                                    <a href="{% url 'boutique:export_employees' %}" class="btn btn-outline-secondary btn-sm">
                                        <i class="bi bi-download me-1"></i>Exporter
                                    </a>
                                    <a href="{% url 'admin:boutique_employe_changelist' %}" class="btn btn-outline-primary btn-sm">
                                        <i class="bi bi-gear me-1"></i>Gérer
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        {% for employe in employes %}
                        <div class="employee-row">
                            <div class="employee-main-info">
                                <div class="employee-profile">
                                    {% if employe.photo %}
                                        <img src="{{ employe.photo.url }}" alt="{{ employe.user.get_full_name }}" class="profile-image">
                                    {% else %}
                                        <div class="profile-placeholder">
                                            <i class="bi bi-person"></i>
                                        </div>
                                    {% endif %}
                                    <div class="profile-details">
                                        <div class="employee-name">{{ employe.user.get_full_name }}</div>
                                        <div class="employee-id">{{ employe.numero_employe }}</div>
                                    </div>
                                </div>

                                <div class="job-info">
                                    <div class="job-title">{{ employe.get_poste_display }}</div>
                                    <div class="hire-date">Embauché le {{ employe.date_embauche|date:"d/m/Y" }}</div>
                                </div>

                                <div class="contact-info">
                                    <div class="phone">
                                        <i class="bi bi-telephone me-1"></i>
                                        {{ employe.telephone }}
                                    </div>
                                    <div class="email">
                                        <i class="bi bi-envelope me-1"></i>
                                        {{ employe.user.email }}
                                    </div>
                                </div>

                                <div class="status-info">
                                    {% if employe.statut == 'actif' %}
                                        <span class="status-badge status-active">
                                            <i class="bi bi-check-circle me-1"></i>Actif
                                        </span>
                                    {% elif employe.statut == 'conge' %}
                                        <span class="status-badge status-leave">
                                            <i class="bi bi-calendar-x me-1"></i>En congé
                                        </span>
                                    {% elif employe.statut == 'inactif' %}
                                        <span class="status-badge status-inactive">
                                            <i class="bi bi-pause-circle me-1"></i>Inactif
                                        </span>
                                    {% elif employe.statut == 'suspendu' %}
                                        <span class="status-badge status-suspended">
                                            <i class="bi bi-x-circle me-1"></i>Suspendu
                                        </span>
                                    {% endif %}
                                </div>

                                <div class="salary-info">
                                    <div class="salary-amount">{{ employe.salaire|floatformat:0 }} XOF</div>
                                    <div class="salary-label">Salaire mensuel</div>
                                </div>

                                <div class="employee-actions">
                                    <div class="btn-group">
                                        <a href="{% url 'admin:boutique_employe_change' employe.id %}"
                                           class="btn btn-sm btn-outline-primary" title="Modifier">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <button class="btn btn-sm btn-outline-info"
                                                onclick="viewEmployeeDetails({{ employe.id }})" title="Détails">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <a href="{% url 'boutique:print_employee_card' employe.id %}"
                                           class="btn btn-sm btn-outline-secondary" title="Carte employé">
                                            <i class="bi bi-card-text"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="empty-state-large">
                            <div class="empty-icon">
                                <i class="bi bi-people"></i>
                            </div>
                            <h4 class="empty-title">Aucun employé</h4>
                            <p class="empty-description">Commencez par ajouter des employés à votre équipe.</p>
                            <a href="{% url 'admin:boutique_employe_add' %}" class="btn btn-primary-modern">
                                <i class="bi bi-person-plus me-2"></i>Ajouter un employé
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal pour les détails employé - Version améliorée -->
<div class="modal fade" id="employeeDetailsModal" tabindex="-1" aria-labelledby="employeeDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content modern-modal">
            <div class="modal-header modern-modal-header">
                <h5 class="modal-title" id="employeeDetailsModalLabel">
                    <i class="bi bi-person-circle me-2"></i>Détails de l'Employé
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fermer"></button>
            </div>
            <div class="modal-body" id="employeeDetailsContent">
                <div class="text-center p-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Chargement...</span>
                    </div>
                    <p class="mt-3">Chargement des informations...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-2"></i>Fermer
                </button>
                <a href="#" class="btn btn-primary" id="editEmployeeLink">
                    <i class="bi bi-pencil me-2"></i>Modifier
                </a>
            </div>
        </div>
    </div>
</div>

<style>
/* Variables */
:root {
    --admin-primary: #667eea;
    --admin-success: #28a745;
    --admin-warning: #ffc107;
    --admin-danger: #dc3545;
    --admin-info: #17a2b8;
    --admin-secondary: #6c757d;
    --admin-dark: #343a40;
    --admin-light: #f8f9fa;
    --admin-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
    --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
    --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
    --border-radius: 12px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Page générale */
.admin-hr-page {
    min-height: 100vh;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}

/* En-tête */
.page-header {
    background: var(--admin-gradient);
    color: white;
    padding: 2rem 0;
}

.page-title {
    font-size: 2.25rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.page-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    margin-bottom: 0;
}

/* Cartes statistiques RH */
.hr-stat-card {
    background: white;
    border-radius: var(--border-radius);
    padding: 2rem;
    box-shadow: var(--shadow-md);
    position: relative;
    overflow: hidden;
    transition: var(--transition);
    height: 100%;
}

.hr-stat-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}

.hr-stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
}

.stat-employees::before { background: var(--admin-success); }
.stat-attendance::before { background: var(--admin-info); }
.stat-leaves::before { background: var(--admin-warning); }
.stat-on-leave::before { background: var(--admin-danger); }

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    color: white;
}

.stat-employees .stat-icon { background: linear-gradient(135deg, var(--admin-success), rgba(40, 167, 69, 0.8)); }
.stat-attendance .stat-icon { background: linear-gradient(135deg, var(--admin-info), rgba(23, 162, 184, 0.8)); }
.stat-leaves .stat-icon { background: linear-gradient(135deg, var(--admin-warning), rgba(255, 193, 7, 0.8)); }
.stat-on-leave .stat-icon { background: linear-gradient(135deg, var(--admin-danger), rgba(220, 53, 69, 0.8)); }

.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--admin-dark);
    margin-bottom: 0.5rem;
}

.stat-label {
    font-size: 0.9rem;
    color: #6c757d;
    margin-bottom: 1rem;
    font-weight: 500;
}

.stat-trend {
    display: flex;
    align-items: center;
    font-size: 0.85rem;
    color: var(--admin-success);
    font-weight: 500;
}

.stat-trend i {
    margin-right: 0.5rem;
}

.stat-chart {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 60px;
    height: 60px;
    opacity: 0.1;
}

.mini-chart {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: conic-gradient(var(--admin-primary) 0deg, var(--admin-primary) calc(var(--percentage, 0) * 3.6deg), transparent calc(var(--percentage, 0) * 3.6deg));
}

/* Cartes RH */
.hr-card {
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-md);
    overflow: hidden;
    margin-bottom: 1.5rem;
}

.hr-card .card-header {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    padding: 1.5rem 2rem;
    border-bottom: 1px solid rgba(0,0,0,0.1);
}

.hr-card .card-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--admin-dark);
    margin-bottom: 0;
}

/* Demandes de congé */
.leave-request-item {
    display: flex;
    align-items: center;
    padding: 1.5rem 2rem;
    border-bottom: 1px solid rgba(0,0,0,0.1);
    transition: var(--transition);
}

.leave-request-item:hover {
    background: rgba(255, 193, 7, 0.05);
}

.leave-request-item:last-child {
    border-bottom: none;
}

.employee-info {
    display: flex;
    align-items: center;
    min-width: 200px;
    margin-right: 1.5rem;
}

.employee-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    margin-right: 1rem;
    overflow: hidden;
    flex-shrink: 0;
}

.employee-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.avatar-placeholder {
    width: 100%;
    height: 100%;
    background: var(--admin-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.25rem;
}

.employee-name {
    font-weight: 600;
    color: var(--admin-dark);
    font-size: 0.95rem;
    margin-bottom: 0.25rem;
}

.employee-position {
    font-size: 0.8rem;
    color: #6c757d;
}

.leave-details {
    flex-grow: 1;
    margin-right: 1rem;
}

.type-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    margin-bottom: 0.5rem;
}

.type-annuel { background: rgba(40, 167, 69, 0.2); color: #155724; }
.type-maladie { background: rgba(220, 53, 69, 0.2); color: #721c24; }
.type-maternite { background: rgba(102, 126, 234, 0.2); color: #4c63d2; }
.type-formation { background: rgba(23, 162, 184, 0.2); color: #0c5460; }

.leave-period,
.leave-reason {
    font-size: 0.85rem;
    color: #6c757d;
    margin-bottom: 0.25rem;
}

.duration {
    font-weight: 600;
    color: var(--admin-warning);
}

/* Présences */
.attendance-item {
    display: flex;
    align-items: center;
    padding: 1.5rem 2rem;
    border-bottom: 1px solid rgba(0,0,0,0.1);
    transition: var(--transition);
}

.attendance-item:hover {
    background: rgba(23, 162, 184, 0.05);
}

.attendance-item:last-child {
    border-bottom: none;
}

.attendance-details {
    flex-grow: 1;
    margin: 0 1rem;
}

.time-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.arrival-time,
.departure-time,
.status-working {
    font-size: 0.85rem;
    color: #6c757d;
}

.arrival-time strong,
.departure-time strong {
    color: var(--admin-dark);
}

.attendance-summary {
    min-width: 80px;
    text-align: center;
}

.hours-badge {
    background: var(--admin-info);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.9rem;
}

.pulse-dot {
    width: 12px;
    height: 12px;
    background: var(--admin-success);
    border-radius: 50%;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
    100% { transform: scale(1); opacity: 1; }
}

/* Liste des employés */
.employee-row {
    border-bottom: 1px solid rgba(0,0,0,0.1);
    transition: var(--transition);
}

.employee-row:hover {
    background: rgba(102, 126, 234, 0.05);
}

.employee-row:last-child {
    border-bottom: none;
}

.employee-main-info {
    display: grid;
    grid-template-columns: 2fr 1.5fr 2fr 1fr 1.5fr 1fr;
    gap: 1rem;
    padding: 1.5rem 2rem;
    align-items: center;
}

.employee-profile {
    display: flex;
    align-items: center;
}

.profile-image {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: 1rem;
}

.profile-placeholder {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--admin-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    margin-right: 1rem;
}

.employee-name {
    font-weight: 600;
    color: var(--admin-dark);
    font-size: 1rem;
    margin-bottom: 0.25rem;
}

.employee-id {
    font-size: 0.8rem;
    color: #6c757d;
    font-family: monospace;
}

.job-title {
    font-weight: 600;
    color: var(--admin-primary);
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
}

.hire-date {
    font-size: 0.8rem;
    color: #6c757d;
}

.phone,
.email {
    font-size: 0.85rem;
    color: #6c757d;
    margin-bottom: 0.25rem;
}

.status-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.375rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.status-active { background: rgba(40, 167, 69, 0.2); color: #155724; }
.status-leave { background: rgba(255, 193, 7, 0.2); color: #856404; }
.status-inactive { background: rgba(108, 117, 125, 0.2); color: #495057; }
.status-suspended { background: rgba(220, 53, 69, 0.2); color: #721c24; }

.salary-amount {
    font-weight: 700;
    color: var(--admin-success);
    font-size: 1rem;
    margin-bottom: 0.25rem;
}

.salary-label {
    font-size: 0.8rem;
    color: #6c757d;
}

/* États vides */
.empty-state {
    text-align: center;
    padding: 3rem 2rem;
    color: #6c757d;
}

.empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.empty-state p {
    margin-bottom: 0;
    font-size: 0.9rem;
}

.empty-state-large {
    text-align: center;
    padding: 4rem 2rem;
    color: #6c757d;
}

.empty-icon {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    opacity: 0.5;
}

.empty-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--admin-dark);
    margin-bottom: 1rem;
}

.empty-description {
    font-size: 1rem;
    margin-bottom: 2rem;
}

.btn-primary-modern {
    background: var(--admin-gradient);
    border: none;
    border-radius: 8px;
    padding: 0.75rem 1.5rem;
    font-weight: 500;
    transition: var(--transition);
}

.btn-primary-modern:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

/* Modal styles améliorés */
.modern-modal {
    border-radius: var(--border-radius);
    border: none;
    box-shadow: var(--shadow-lg);
    overflow: hidden;
}

.modern-modal-header {
    background: var(--admin-gradient);
    color: white;
    border-bottom: none;
    padding: 1.5rem;
}

.modal-body {
    padding: 2rem;
    background: white;
}

.modal-footer {
    border-top: 1px solid rgba(0,0,0,0.1);
    background: #f8f9fa;
    padding: 1rem 1.5rem;
}

/* Responsive */
@media (max-width: 1200px) {
    .employee-main-info {
        grid-template-columns: 1fr 1fr 1fr;
        gap: 1rem;
    }

    .contact-info,
    .salary-info {
        display: none;
    }
}

@media (max-width: 768px) {
    .page-title {
        font-size: 1.75rem;
    }

    .hr-stat-card {
        padding: 1.5rem;
    }

    .stat-number {
        font-size: 2rem;
    }

    .employee-main-info {
        grid-template-columns: 1fr;
        gap: 1rem;
        text-align: left;
    }

    .leave-request-item,
    .attendance-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }

    .employee-info {
        margin-right: 0;
        margin-bottom: 1rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animation des compteurs
    function animateCounters() {
        const counters = document.querySelectorAll('[data-count]');

        counters.forEach(counter => {
            const target = parseInt(counter.getAttribute('data-count'));
            const duration = 2000;
            const step = target / (duration / 16);
            let current = 0;

            const timer = setInterval(() => {
                current += step;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                counter.textContent = Math.floor(current);
            }, 16);
        });
    }

    // Animation des graphiques circulaires
    function animateCharts() {
        const charts = document.querySelectorAll('.mini-chart');

        charts.forEach(chart => {
            const percentage = chart.getAttribute('data-percentage');
            chart.style.setProperty('--percentage', percentage);
        });
    }

    // Démarrer les animations
    setTimeout(() => {
        animateCounters();
        animateCharts();
    }, 500);

    // Fonction pour voir les détails d'un employé - Version améliorée
    window.viewEmployeeDetails = function(employeeId) {
        const modal = new bootstrap.Modal(document.getElementById('employeeDetailsModal'));
        const content = document.getElementById('employeeDetailsContent');
        const editLink = document.getElementById('editEmployeeLink');

        // Mettre à jour le lien d'édition
        editLink.href = `/admin/boutique/employe/${employeeId}/change/`;

        // Afficher le spinner
        content.innerHTML = `
            <div class="text-center p-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Chargement...</span>
                </div>
                <p class="mt-3">Chargement des informations de l'employé...</p>
            </div>
        `;

        modal.show();

        // Charger les données
        fetch(`/admin-employee-details/${employeeId}/`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erreur réseau');
                }
                return response.json();
            })
            .then(data => {
                content.innerHTML = `
                    <div class="row">
                        <div class="col-md-4 text-center">
                            ${data.employe.photo_url ?
                                `<img src="${data.employe.photo_url}" alt="${data.employe.nom_complet}" class="rounded-circle mb-3" style="width: 120px; height: 120px; object-fit: cover;">` :
                                `<div class="rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 120px; height: 120px; background: var(--admin-gradient);"><i class="bi bi-person text-white" style="font-size: 3rem;"></i></div>`
                            }
                            <h5>${data.employe.nom_complet}</h5>
                            <p class="text-muted">${data.employe.poste}</p>
                        </div>
                        <div class="col-md-8">
                            <h6 class="border-bottom pb-2 mb-3">Informations générales</h6>
                            <table class="table table-sm">
                                <tr><td><strong>N° Employé:</strong></td><td>${data.employe.numero_employe}</td></tr>
                                <tr><td><strong>Email:</strong></td><td>${data.employe.email}</td></tr>
                                <tr><td><strong>Téléphone:</strong></td><td>${data.employe.telephone}</td></tr>
                                <tr><td><strong>Date d'embauche:</strong></td><td>${data.employe.date_embauche}</td></tr>
                                <tr><td><strong>Salaire:</strong></td><td>${data.employe.salaire}</td></tr>
                                <tr><td><strong>Statut:</strong></td><td>${data.employe.statut}</td></tr>
                            </table>

                            <h6 class="border-bottom pb-2 mb-3 mt-4">Statistiques</h6>
                            <div class="row">
                                <div class="col-6">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <h5 class="text-primary">${data.statistiques.presences_ce_mois}</h5>
                                            <small>Présences ce mois</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <h5 class="text-success">${data.statistiques.heures_travaillees_mois}</h5>
                                            <small>Heures travaillées</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="border-bottom pb-2 mb-3">Présences récentes</h6>
                            <div class="list-group list-group-flush">
                                ${data.presences_recentes && data.presences_recentes.length > 0 ?
                                    data.presences_recentes.map(p => `
                                        <div class="list-group-item d-flex justify-content-between">
                                            <span>${p.date}</span>
                                            <span>${p.heure_arrivee} - ${p.heure_depart}</span>
                                        </div>
                                    `).join('') :
                                    '<div class="text-center text-muted py-3">Aucune présence récente</div>'
                                }
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6 class="border-bottom pb-2 mb-3">Congés récents</h6>
                            <div class="list-group list-group-flush">
                                ${data.conges_recents && data.conges_recents.length > 0 ?
                                    data.conges_recents.map(c => `
                                        <div class="list-group-item">
                                            <div class="d-flex justify-content-between">
                                                <span>${c.type}</span>
                                                <span class="badge bg-${c.statut === 'Approuvé' ? 'success' : c.statut === 'Refusé' ? 'danger' : 'warning'}">${c.statut}</span>
                                            </div>
                                            <small class="text-muted">${c.date_debut} - ${c.date_fin} (${c.nombre_jours} jour${c.nombre_jours > 1 ? 's' : ''})</small>
                                        </div>
                                    `).join('') :
                                    '<div class="text-center text-muted py-3">Aucun congé récent</div>'
                                }
                            </div>
                        </div>
                    </div>
                `;
            })
            .catch(error => {
                content.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        Erreur lors du chargement des détails de l'employé: ${error.message}
                    </div>
                    <div class="text-center mt-4">
                        <button type="button" class="btn btn-primary" onclick="viewEmployeeDetails(${employeeId})">
                            <i class="bi bi-arrow-clockwise me-2"></i>Réessayer
                        </button>
                    </div>
                `;
            });
    };

    // Animation d'entrée des éléments
    const items = document.querySelectorAll('.hr-stat-card, .hr-card, .employee-row, .leave-request-item, .attendance-item');

    items.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(20px)';

        setTimeout(() => {
            item.style.transition = 'all 0.5s ease-out';
            item.style.opacity = '1';
            item.style.transform = 'translateY(0)';
        }, index * 100);
    });
});
</script>
{% endblock %}